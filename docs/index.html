<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convoluted Proof: √2 is Irrational</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --bg: #0d1117;
            --fg: #c9d1d9;
            --accent: #58a6ff;
            --accent2: #7ee787;
            --muted: #8b949e;
            --code-bg: #161b22;
            --warn: #d29922;
        }
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        h1, h2, h3 { color: var(--accent); }
        h1 { border-bottom: 1px solid #30363d; padding-bottom: 0.5rem; }
        a { color: var(--accent); }
        code { background: var(--code-bg); padding: 0.2em 0.4em; border-radius: 3px; }
        pre { background: var(--code-bg); padding: 1rem; border-radius: 6px; overflow-x: auto; }
        pre code { padding: 0; background: none; }
        .proof-state {
            background: #1c2128;
            border-left: 3px solid var(--accent);
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .proof-state-header {
            color: var(--muted);
            font-size: 0.8em;
            margin-bottom: 0.5rem;
        }
        .theorem-box {
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            background: #161b22;
        }
        .theorem-box h3 { margin-top: 0; }
        blockquote {
            border-left: 3px solid var(--muted);
            padding-left: 1rem;
            color: var(--muted);
        }
        .section { margin: 2rem 0; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            border: 1px solid #30363d;
            padding: 0.75rem;
            text-align: left;
        }
        th { background: #161b22; color: var(--accent); }
        tr:nth-child(even) { background: #161b22; }
        .metric {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent2);
        }
        .metric-label {
            color: var(--muted);
            font-size: 0.9em;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .metric-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 1rem;
            text-align: center;
        }
        .independent { color: var(--accent2); }
        .same-core { color: var(--warn); }
    </style>
</head>
<body>
    <h1>Convoluted Proof: √2 is Irrational</h1>

    <p>A sophisticated proof using <strong>Dirichlet's theorem</strong>, <strong>quadratic reciprocity</strong>,
    and <strong>ultrafilters</strong> in Lean 4 with Mathlib.</p>

    <blockquote>
        Based on <a href="https://math.stackexchange.com/questions/1311228/">Asaf Karagila's ultrafilter-based proof</a>.
        This is a formalization of an "awfully sophisticated proof for a simple fact."
    </blockquote>

    <div class="section">
        <h2>Proof Comparison: Quantified</h2>

        <p>How does this proof compare to the standard one taught in schools?</p>

        <table>
            <tr>
                <th>Metric</th>
                <th>Standard (Parity)</th>
                <th>This (Dirichlet+QR)</th>
                <th>Ultraproduct Version</th>
            </tr>
            <tr>
                <td><strong>Lines of Lean code</strong></td>
                <td>~3 lines*</td>
                <td>~120 lines</td>
                <td>~250 lines</td>
            </tr>
            <tr>
                <td><strong>Key mathematical fact</strong></td>
                <td>n² even ⟹ n even</td>
                <td>Legendre symbol (2|p) = -1</td>
                <td>+ Łoś's theorem</td>
            </tr>
            <tr>
                <td><strong>Deepest dependency</strong></td>
                <td>Nat.Prime.not_isSquare</td>
                <td>Nat.infinite_setOf_prime_and_eq_mod</td>
                <td>+ hyperfilter existence</td>
            </tr>
            <tr>
                <td><strong>Mathematical era</strong></td>
                <td>Ancient Greece (~500 BCE)</td>
                <td>19th century (Dirichlet 1837)</td>
                <td>20th century (Łoś 1955)</td>
            </tr>
            <tr>
                <td><strong>Requires "lowest terms"?</strong></td>
                <td>Yes</td>
                <td>No</td>
                <td>No</td>
            </tr>
            <tr>
                <td><strong>Choice axiom essential?</strong></td>
                <td>No</td>
                <td>No</td>
                <td><strong>Yes</strong> (for ultrafilter)</td>
            </tr>
        </table>

        <p><small>*Mathlib's <code>irrational_sqrt_two</code> is 1 line, calling into ~100 lines of supporting lemmas</small></p>

        <h3>Axioms Used (Lean verification)</h3>

        <p>All three proofs use the same foundational axioms:</p>

<pre><code class="language-lean">#print axioms irrational_sqrt_2
-- 'irrational_sqrt_2' depends on axioms: [propext, Classical.choice, Quot.sound]

#print axioms irrational_sqrt_2_ultraproduct
-- 'irrational_sqrt_2_ultraproduct' depends on axioms: [propext, Classical.choice, Quot.sound]

#print axioms irrational_sqrt_two  -- Mathlib's standard proof
-- 'irrational_sqrt_two' depends on axioms: [propext, Classical.choice, Quot.sound]</code></pre>

        <p>The axioms are identical because Mathlib uses <code>Classical.choice</code> pervasively.
        However, the <strong>mathematical dependencies</strong> are completely different.</p>

        <h3>Are They Independent Proofs?</h3>

        <table>
            <tr>
                <th>Comparison</th>
                <th>Verdict</th>
                <th>Reason</th>
            </tr>
            <tr>
                <td>Standard vs. This proof</td>
                <td class="independent">✓ INDEPENDENT</td>
                <td>Different core lemmas (parity vs. quadratic residues)</td>
            </tr>
            <tr>
                <td>Standard vs. Ultraproduct</td>
                <td class="independent">✓ INDEPENDENT</td>
                <td>Different core lemmas</td>
            </tr>
            <tr>
                <td>Direct vs. Ultraproduct</td>
                <td class="same-core">⚠ SAME CORE</td>
                <td>Both use Dirichlet + QR; ultraproduct just packages it</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h2>The Key Idea</h2>
        <p>Instead of the usual proof by contradiction using parity, we use heavy machinery:</p>
        <ol>
            <li><strong>Dirichlet's Theorem:</strong> There are infinitely many primes p ≡ 3 (mod 8)</li>
            <li><strong>Quadratic Reciprocity:</strong> For such primes, 2 is NOT a quadratic residue mod p</li>
            <li><strong>Ultraproducts:</strong> Construct an ultraproduct of fields ℤ/pℤ over these primes</li>
            <li><strong>Łoś's Theorem:</strong> x² = 2 has no solution in the ultraproduct</li>
        </ol>
        <p>If √2 = a/b were rational, then for any sufficiently large prime p (not dividing b),
        we'd have (a/b)² ≡ 2 (mod p), contradicting that 2 is not a square mod p!</p>
    </div>

    <div class="section">
        <h2>Side-by-Side: Standard vs. This Proof</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="theorem-box">
                <h3>Standard Proof (Parity)</h3>
<pre><code class="language-text">Assume √2 = a/b in lowest terms
→ a² = 2b²
→ a² is even
→ a is even (a = 2k)
→ 4k² = 2b², so b² = 2k²
→ b is even
→ Both even contradicts "lowest terms"
→ ⊥</code></pre>
                <p><strong>Core fact:</strong> If n² is even, then n is even</p>
            </div>

            <div class="theorem-box">
                <h3>This Proof (Dirichlet + QR)</h3>
<pre><code class="language-text">Assume √2 = a/b
→ a² = 2b²
→ Pick prime p ≡ 3 (mod 8), p > max(a,b)
→ p ∤ b, so b invertible mod p
→ (a/b)² ≡ 2 (mod p)
→ 2 is a square mod p
→ But QR says 2 is NOT a square mod p
→ ⊥</code></pre>
                <p><strong>Core fact:</strong> Legendre symbol (2|p) = -1 for p ≡ 3 (mod 8)</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Core Components</h2>

        <div class="theorem-box">
            <h3>Primes ≡ 3 (mod 8) are Infinite</h3>
            <p>Using Dirichlet's theorem on primes in arithmetic progressions:</p>
<pre><code class="language-lean">lemma primes_three_mod_eight_infinite :
    primes_three_mod_eight.Infinite := by
  exact Nat.infinite_setOf_prime_and_eq_mod three_unit_mod_eight</code></pre>
            <div class="proof-state">
                <div class="proof-state-header">Proof relies on:</div>
                <code>Nat.infinite_setOf_prime_and_eq_mod</code> — Dirichlet's theorem in Mathlib
            </div>
        </div>

        <div class="theorem-box">
            <h3>2 is Not a Square mod p (for p ≡ 3 mod 8)</h3>
            <p>By quadratic reciprocity, the Legendre symbol (2|p) = -1 when p ≡ 3 (mod 8):</p>
<pre><code class="language-lean">lemma two_not_square_mod_prime_three_mod_eight (p : ℕ)
    (hp : p.Prime ∧ (p : ZMod 8) = 3) (hp2 : p ≠ 2) :
    ¬IsSquare (2 : ZMod p) := by
  haveI : Fact p.Prime := ⟨hp.1⟩
  have : p % 8 = 3 := ...
  rw [ZMod.exists_sq_eq_two_iff hp2]
  push_neg
  constructor
  · intro h; rw [this] at h; norm_num at h
  · intro h; rw [this] at h; norm_num at h</code></pre>
            <div class="proof-state">
                <div class="proof-state-header">Key lemma:</div>
                <code>ZMod.exists_sq_eq_two_iff</code> — 2 is a square mod p iff p ≡ ±1 (mod 8)
            </div>
        </div>

        <div class="theorem-box">
            <h3>The Contradiction</h3>
            <p>If √2 = a/b, then a² = 2b². For any prime p > max(a,b) with p ≡ 3 (mod 8):</p>
<pre><code class="language-lean">lemma rational_sqrt_two_contradiction (q : ℚ) (hq : (q : ℝ) = √2) : False := by
  -- Get coprime representation √2 = a/b
  obtain ⟨a, b, hb_pos, _hcop, h_ratio⟩ := rat_to_coprime_pair q hq_pos
  have hsq : a ^ 2 = 2 * b ^ 2 := sqrt_two_eq_ratio_implies_square_eq a b hb_pos h_sqrt_ratio

  -- Find a prime p ≡ 3 (mod 8) with p > max(a,b)
  obtain ⟨p, hp_mem, hbig⟩ : ∃ p ∈ primes_three_mod_eight, max a b < p := by
    simpa using primes_three_mod_eight_infinite.exists_gt (max a b)

  -- p doesn't divide b (since p > b), so 2 is a square mod p
  have sq2_in_Fp : IsSquare (2 : ZMod p) := two_is_square_mod_p p a b hsq hpb

  -- But quadratic reciprocity says 2 is NOT a square mod p
  have not_sq2_in_Fp : ¬ IsSquare (2 : ZMod p) :=
    two_not_square_mod_prime_three_mod_eight p hp_mem hp_ne_2

  -- Contradiction!
  exact not_sq2_in_Fp sq2_in_Fp</code></pre>
        </div>
    </div>

    <div class="section">
        <h2>Ultraproduct Machinery (Optional Overkill)</h2>

        <p>The ultraproduct version adds ~130 more lines to package "for almost all p" into a single algebraic object:</p>

        <div class="theorem-box">
            <h3>The Index Set and Ultrafilter</h3>
<pre><code class="language-lean">-- The subtype of primes ≡ 3 (mod 8)
abbrev PrimesMod3_8 : Type := {p : ℕ // p.Prime ∧ (p : ZMod 8) = 3}

-- Non-principal ultrafilter extending the cofinite filter
noncomputable def ultrafilterOnPrimes : Ultrafilter PrimesMod3_8 :=
  hyperfilter PrimesMod3_8  -- ← Requires Axiom of Choice!

-- The ultraproduct ∏_U ZMod p
noncomputable abbrev Ultraproduct : Type :=
  (ultrafilterOnPrimes : Filter PrimesMod3_8).Product FieldFamily</code></pre>
        </div>

        <div class="theorem-box">
            <h3>Why Ultraproducts are Overkill Here</h3>
            <p>The ultraproduct proof shows:</p>
            <ul>
                <li>"x² = 2 has no solution" holds in <strong>almost all</strong> factors</li>
                <li>By Łoś's theorem, no solution exists in the ultraproduct</li>
            </ul>
            <p>But we only need: "x² = 2 has no solution" holds in <strong>one</strong> factor (any large p).</p>
            <p>It's like proving "this glass contains water" by analyzing the thermodynamic properties of the entire ocean.</p>
        </div>
    </div>

    <div class="section">
        <h2>Can We Avoid Choice?</h2>

        <table>
            <tr>
                <th>Proof</th>
                <th>Choice Required?</th>
                <th>Why?</th>
            </tr>
            <tr>
                <td>Standard (parity)</td>
                <td>No*</td>
                <td>Pure arithmetic + well-ordering</td>
            </tr>
            <tr>
                <td>This (direct)</td>
                <td>No*</td>
                <td>Just picks one prime</td>
            </tr>
            <tr>
                <td>This (ultraproduct)</td>
                <td><strong>Yes</strong></td>
                <td>hyperfilter requires Boolean Prime Ideal Theorem</td>
            </tr>
        </table>

        <p><small>*Mathlib uses Classical.choice pervasively, but the mathematical content doesn't require it</small></p>
    </div>

    <div class="section">
        <h2>Axioms Used</h2>
        <p>All proofs use standard mathematical axioms (verified by Lean):</p>
        <ul>
            <li><code>propext</code> — Propositional extensionality</li>
            <li><code>Classical.choice</code> — Axiom of choice</li>
            <li><code>Quot.sound</code> — Quotient soundness</li>
        </ul>
        <p>No custom axioms were introduced. The proof is independent of Mathlib's existing
        <code>irrational_sqrt_two</code> theorem (verified: we don't import or reference it).</p>
    </div>

    <div class="section">
        <h2>✅ Verified Independence</h2>

        <p>This proof is <strong>genuinely independent</strong> of Mathlib's standard proof. We verified this by
        commenting out Mathlib's theorems and rebuilding:</p>

        <div class="theorem-box">
            <h3>How to Reproduce</h3>
            <p>You can verify independence yourself by temporarily disabling Mathlib's proof:</p>

<pre><code class="language-bash"># 1. Comment out Mathlib's theorems in .lake/packages/mathlib/Mathlib/NumberTheory/Real/Irrational.lean:
#    - Line 132: Nat.Prime.irrational_sqrt
#    - Line 136: irrational_sqrt_two
#    - Line 511: exists_irrational_btwn (depends on the above)

# 2. Wrap each theorem in block comments:
#    /- ... theorem ... -/

# 3. Rebuild
lake build Sqrt2Irrational

# 4. If the build succeeds, the proof is independent!</code></pre>

            <div class="proof-state">
                <div class="proof-state-header">Result:</div>
                <strong style="color: var(--accent2);">Build completed successfully (3326 jobs)</strong><br>
                Both <code>irrational_sqrt_2</code> and <code>irrational_sqrt_2_ultraproduct</code> compile
                without any dependency on Mathlib's standard proof.
            </div>
        </div>

        <h3>What This Proves</h3>
        <table>
            <tr>
                <th>Mathlib's Proof Uses</th>
                <th>Our Proof Uses</th>
            </tr>
            <tr>
                <td><code>Nat.Prime.irrational_sqrt</code></td>
                <td><code>Nat.infinite_setOf_prime_and_eq_mod</code></td>
            </tr>
            <tr>
                <td><code>Nat.Prime.not_isSquare</code></td>
                <td><code>ZMod.exists_sq_eq_two_iff</code></td>
            </tr>
            <tr>
                <td>Parity/factorization argument</td>
                <td>Dirichlet's theorem + quadratic reciprocity</td>
            </tr>
        </table>

        <p>Neither proof can be derived from the other without re-proving the core lemmas from scratch.</p>
    </div>

    <div class="section">
        <h2>Source Code</h2>
        <p>Full source: <a href="https://github.com/alok/Sqrt2Irrational">github.com/alok/Sqrt2Irrational</a></p>
        <p>Built with Lean 4.26.0-rc2 and Mathlib (latest master).</p>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
