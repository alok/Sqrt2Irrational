<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convoluted Proof: √2 is Irrational</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --bg: #0d1117;
            --fg: #c9d1d9;
            --accent: #58a6ff;
            --muted: #8b949e;
            --code-bg: #161b22;
        }
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        h1, h2, h3 { color: var(--accent); }
        h1 { border-bottom: 1px solid #30363d; padding-bottom: 0.5rem; }
        a { color: var(--accent); }
        code { background: var(--code-bg); padding: 0.2em 0.4em; border-radius: 3px; }
        pre { background: var(--code-bg); padding: 1rem; border-radius: 6px; overflow-x: auto; }
        pre code { padding: 0; background: none; }
        .proof-state {
            background: #1c2128;
            border-left: 3px solid var(--accent);
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .proof-state-header {
            color: var(--muted);
            font-size: 0.8em;
            margin-bottom: 0.5rem;
        }
        .theorem-box {
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            background: #161b22;
        }
        .theorem-box h3 { margin-top: 0; }
        .math { font-style: italic; }
        blockquote {
            border-left: 3px solid var(--muted);
            padding-left: 1rem;
            color: var(--muted);
        }
        .section { margin: 2rem 0; }
    </style>
</head>
<body>
    <h1>Convoluted Proof: √2 is Irrational</h1>

    <p>A sophisticated proof using <strong>Dirichlet's theorem</strong>, <strong>quadratic reciprocity</strong>,
    and <strong>ultrafilters</strong> in Lean 4 with Mathlib.</p>

    <blockquote>
        Based on <a href="https://math.stackexchange.com/questions/1311228/">Asaf Karagila's ultrafilter-based proof</a>.
        This is a formalization of an "awfully sophisticated proof for a simple fact."
    </blockquote>

    <div class="section">
        <h2>The Key Idea</h2>
        <p>Instead of the usual proof by contradiction using parity, we use heavy machinery:</p>
        <ol>
            <li><strong>Dirichlet's Theorem:</strong> There are infinitely many primes p ≡ 3 (mod 8)</li>
            <li><strong>Quadratic Reciprocity:</strong> For such primes, 2 is NOT a quadratic residue mod p</li>
            <li><strong>Ultraproducts:</strong> Construct an ultraproduct of fields ℤ/pℤ over these primes</li>
            <li><strong>Łoś's Theorem:</strong> x² = 2 has no solution in the ultraproduct</li>
        </ol>
        <p>If √2 = a/b were rational, then for any sufficiently large prime p (not dividing b),
        we'd have (a/b)² ≡ 2 (mod p), contradicting that 2 is not a square mod p!</p>
    </div>

    <div class="section">
        <h2>Core Components</h2>

        <div class="theorem-box">
            <h3>Primes ≡ 3 (mod 8) are Infinite</h3>
            <p>Using Dirichlet's theorem on primes in arithmetic progressions:</p>
<pre><code class="language-lean">lemma primes_three_mod_eight_infinite :
    primes_three_mod_eight.Infinite := by
  exact Nat.infinite_setOf_prime_and_eq_mod three_unit_mod_eight</code></pre>
            <div class="proof-state">
                <div class="proof-state-header">Proof relies on:</div>
                <code>Nat.infinite_setOf_prime_and_eq_mod</code> — Dirichlet's theorem in Mathlib
            </div>
        </div>

        <div class="theorem-box">
            <h3>2 is Not a Square mod p (for p ≡ 3 mod 8)</h3>
            <p>By quadratic reciprocity, the Legendre symbol (2|p) = -1 when p ≡ 3 (mod 8):</p>
<pre><code class="language-lean">lemma two_not_square_mod_prime_three_mod_eight (p : ℕ)
    (hp : p.Prime ∧ (p : ZMod 8) = 3) (hp2 : p ≠ 2) :
    ¬IsSquare (2 : ZMod p) := by
  haveI : Fact p.Prime := ⟨hp.1⟩
  have : p % 8 = 3 := by
    have hcast : (p : ZMod 8) = 3 := hp.2
    have : ZMod.val (p : ZMod 8) = 3 := by rw [hcast]; rfl
    rwa [ZMod.val_natCast] at this
  rw [ZMod.exists_sq_eq_two_iff hp2]
  push_neg
  constructor
  · intro h; rw [this] at h; norm_num at h
  · intro h; rw [this] at h; norm_num at h</code></pre>
            <div class="proof-state">
                <div class="proof-state-header">Key lemma:</div>
                <code>ZMod.exists_sq_eq_two_iff</code> — 2 is a square mod p iff p ≡ ±1 (mod 8)
            </div>
        </div>

        <div class="theorem-box">
            <h3>The Contradiction</h3>
            <p>If √2 = a/b, then a² = 2b². For any prime p > max(a,b) with p ≡ 3 (mod 8):</p>
<pre><code class="language-lean">lemma rational_sqrt_two_contradiction (q : ℚ) (hq : (q : ℝ) = √2) : False := by
  classical
  -- Get coprime representation √2 = a/b
  obtain ⟨a, b, hb_pos, _hcop, h_ratio⟩ := rat_to_coprime_pair q hq_pos
  have hsq : a ^ 2 = 2 * b ^ 2 := sqrt_two_eq_ratio_implies_square_eq a b hb_pos h_sqrt_ratio

  -- Find a prime p ≡ 3 (mod 8) with p > max(a,b)
  obtain ⟨p, hp_mem, hbig⟩ : ∃ p ∈ primes_three_mod_eight, max a b < p := by
    simpa using primes_three_mod_eight_infinite.exists_gt (max a b)

  -- p doesn't divide b (since p > b)
  have hpb : ¬ (p ∣ b) := by
    intro hdiv
    have hb_lt : b < p := (le_max_right a b).trans_lt hbig
    exact (not_le.mpr hb_lt) (Nat.le_of_dvd hb_pos hdiv)

  -- From a² = 2b² we get that 2 is a square mod p
  have sq2_in_Fp : IsSquare (2 : ZMod p) := two_is_square_mod_p p a b hsq hpb

  -- But 2 is NOT a square mod p (quadratic reciprocity!)
  have not_sq2_in_Fp : ¬ IsSquare (2 : ZMod p) :=
    two_not_square_mod_prime_three_mod_eight p hp_mem hp_ne_2

  -- Contradiction!
  exact not_sq2_in_Fp sq2_in_Fp</code></pre>
        </div>
    </div>

    <div class="section">
        <h2>Ultraproduct Machinery</h2>

        <div class="theorem-box">
            <h3>The Index Set and Ultrafilter</h3>
<pre><code class="language-lean">-- The subtype of primes ≡ 3 (mod 8)
abbrev PrimesMod3_8 : Type := {p : ℕ // p.Prime ∧ (p : ZMod 8) = 3}

-- This set is infinite
instance : Infinite PrimesMod3_8 := by
  have : Set.Infinite primes_three_mod_eight := primes_three_mod_eight_infinite
  exact Set.infinite_coe_iff.mpr this

-- The family of fields indexed by these primes
abbrev FieldFamily (p : PrimesMod3_8) : Type := ZMod p.val

-- Non-principal ultrafilter extending the cofinite filter
noncomputable def ultrafilterOnPrimes : Ultrafilter PrimesMod3_8 :=
  hyperfilter PrimesMod3_8</code></pre>
        </div>

        <div class="theorem-box">
            <h3>The Ultraproduct</h3>
<pre><code class="language-lean">-- The ultraproduct ∏_U ZMod p
noncomputable abbrev Ultraproduct : Type :=
  (ultrafilterOnPrimes : Filter PrimesMod3_8).Product FieldFamily</code></pre>
            <div class="proof-state">
                <div class="proof-state-header">Key properties:</div>
                • Characteristic 0 (for any n, cofinitely many primes p > n)<br>
                • x² = 2 has no solution (by Łoś, since no factor has a solution)
            </div>
        </div>

        <div class="theorem-box">
            <h3>Main Theorem via Ultraproducts</h3>
<pre><code class="language-lean">theorem ultraproduct_no_sqrt_two :
    ¬∃ f : (p : PrimesMod3_8) → FieldFamily p,
      ∀ᶠ p in (ultrafilterOnPrimes : Filter PrimesMod3_8), f p * f p = 2 := by
  intro ⟨f, hf⟩
  -- If f(p)² = 2 for almost all p, then 2 is a square in almost all fields
  have eventually_square : ∀ᶠ p in (ultrafilterOnPrimes : Filter PrimesMod3_8),
      IsSquare (2 : FieldFamily p) := by
    apply Filter.Eventually.mono hf
    intro p hp
    exact ⟨f p, hp.symm⟩
  -- But 2 is not a square in ANY of our fields!
  exact (two_not_square_eventually.and eventually_square).exists.elim
    fun p ⟨hns, hs⟩ => hns hs

theorem irrational_sqrt_2_ultraproduct : Irrational √2 := by
  classical
  rw [irrational_iff_ne_rational]
  intro a b hb h_eq
  apply ultraproduct_no_sqrt_two
  use fun p => (a : ZMod p.val) * (b : ZMod p.val)⁻¹
  -- For p > max(|a|,|b|), we have (a/b)² = 2 in ZMod p
  -- ... [full proof in source]</code></pre>
        </div>
    </div>

    <div class="section">
        <h2>Axioms Used</h2>
        <p>The proof uses standard mathematical axioms:</p>
        <ul>
            <li><code>propext</code> — Propositional extensionality</li>
            <li><code>Classical.choice</code> — Axiom of choice (for ultrafilters)</li>
            <li><code>Quot.sound</code> — Quotient soundness</li>
        </ul>
        <p>No custom axioms were introduced. The proof is independent of Mathlib's existing
        <code>irrational_sqrt_two</code> theorem.</p>
    </div>

    <div class="section">
        <h2>Source Code</h2>
        <p>Full source: <a href="https://github.com/alok/Sqrt2Irrational">github.com/alok/Sqrt2Irrational</a></p>
        <p>Built with Lean 4.26.0-rc2 and Mathlib (latest master).</p>
    </div>

    <script>hljs.highlightAll();</script>
</body>
</html>
